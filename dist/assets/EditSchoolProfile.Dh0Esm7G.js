import{u as L,I as F,w as B,r as l,j as e}from"./index.UZcXu8dh.js";import{l as D,u as I,n as A,o as q}from"./api.CIjYu6Aj.js";function T(){var _;const p=L(),{refreshSchool:y}=F(),{toast:o}=B(),[i,h]=l.useState(null),[C,w]=l.useState(!0),[n,u]=l.useState(!1),[g,b]=l.useState("basic"),j=l.useRef(null),[a,x]=l.useState({school_name:"",email:"",phone:"",address:"",motto:"",primary_color:"#4F46E5",secondary_color:"#9333EA"}),[d,v]=l.useState({current_password:"",new_password:"",confirm_password:""});l.useEffect(()=>{P()},[]);const P=async()=>{try{w(!0);const r=await D();r.success?(h(r.data),x({school_name:r.data.school_name||"",email:r.data.email||"",phone:r.data.phone||"",address:r.data.address||"",motto:r.data.motto||"",primary_color:r.data.primary_color||"#4F46E5",secondary_color:r.data.secondary_color||"#9333EA"})):(o.error("Error loading profile: "+r.message),p("/dashboard/profile"))}catch(r){console.error("Error:",r),o.error("Failed to load profile. Please try again."),p("/dashboard/profile")}finally{w(!1)}},c=r=>{const{name:s,value:m}=r.target;x(t=>({...t,[s]:m}))},f=r=>{const{name:s,value:m}=r.target;v(t=>({...t,[s]:m}))},S=r=>{const s=r.target.files[0];if(s){if(!s.type.startsWith("image/")){o.error("Please select an image file");return}if(s.size>2*1024*1024){o.error("Image size must be less than 2MB");return}const m=new FileReader;m.onloadend=async()=>{try{u(!0);const t=await I(m.result);t.success?(o.success("Logo updated successfully!"),h(E=>({...E,logo:t.logo})),y&&await y()):o.error("Error updating logo: "+t.message)}catch(t){console.error("Error:",t),o.error("Failed to upload logo. Please try again.")}finally{u(!1)}},m.readAsDataURL(s)}},N=async r=>{r.preventDefault(),u(!0);try{const s=await A(a);s.success?(o.success("Profile updated successfully!"),h(s.data)):o.error("Error updating profile: "+s.message)}catch(s){console.error("Error:",s),o.error("Failed to update profile. Please try again.")}finally{u(!1)}},k=async r=>{if(r.preventDefault(),d.new_password!==d.confirm_password){o.error("New password and confirm password do not match");return}if(d.new_password.length<6){o.error("Password must be at least 6 characters long");return}u(!0);try{const s=await q({current_password:d.current_password,new_password:d.new_password});s.success?(o.success("Password changed successfully!"),v({current_password:"",new_password:"",confirm_password:""})):o.error("Error changing password: "+s.message)}catch(s){console.error("Error:",s),o.error("Failed to change password. Please try again.")}finally{u(!1)}};return C?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):e.jsxs("div",{children:[e.jsx("div",{className:"mb-4",children:e.jsxs("button",{onClick:()=>p("/dashboard/profile"),className:"text-sm text-gray-600 hover:text-gray-900 flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back to Profile"]})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Edit School Profile"}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex -mb-px",children:[e.jsx("button",{onClick:()=>b("basic"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${g==="basic"?"border-indigo-600 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Basic Information"}),e.jsx("button",{onClick:()=>b("branding"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${g==="branding"?"border-indigo-600 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Branding"}),e.jsx("button",{onClick:()=>b("password"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${g==="password"?"border-indigo-600 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Change Password"})]})}),e.jsxs("div",{className:"p-8",children:[g==="basic"&&e.jsx("form",{onSubmit:N,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"School Name *"}),e.jsx("input",{type:"text",name:"school_name",value:a.school_name,onChange:c,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),e.jsx("input",{type:"email",name:"email",value:a.email,onChange:c,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),e.jsx("input",{type:"tel",name:"phone",value:a.phone,onChange:c,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address"}),e.jsx("textarea",{name:"address",value:a.address,onChange:c,rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Motto / Tagline"}),e.jsx("input",{type:"text",name:"motto",value:a.motto,onChange:c,placeholder:"e.g., Excellence in Education",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"submit",disabled:n,className:"px-6 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors disabled:bg-gray-400",children:n?"Saving...":"Save Changes"}),e.jsx("button",{type:"button",onClick:()=>p("/dashboard/profile"),className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})}),g==="branding"&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"School Logo"}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"w-32 h-32 rounded-lg border-2 border-gray-300 flex items-center justify-center overflow-hidden bg-gray-50",children:i!=null&&i.logo?e.jsx("img",{src:i.logo,alt:"School Logo",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-4xl font-bold text-gray-400",children:(_=i==null?void 0:i.school_name)==null?void 0:_.charAt(0)})}),e.jsxs("div",{children:[e.jsx("input",{ref:j,type:"file",accept:"image/*",onChange:S,className:"hidden"}),e.jsx("button",{type:"button",onClick:()=>{var r;return(r=j.current)==null?void 0:r.click()},disabled:n,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors disabled:bg-gray-400",children:n?"Uploading...":"Upload New Logo"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"PNG, JPG, or GIF (max 2MB)"})]})]})]}),e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Primary Color"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"color",name:"primary_color",value:a.primary_color,onChange:c,className:"h-12 w-20 rounded cursor-pointer"}),e.jsx("input",{type:"text",value:a.primary_color,onChange:r=>x(s=>({...s,primary_color:r.target.value})),className:"flex-1 px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Secondary Color"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"color",name:"secondary_color",value:a.secondary_color,onChange:c,className:"h-12 w-20 rounded cursor-pointer"}),e.jsx("input",{type:"text",value:a.secondary_color,onChange:r=>x(s=>({...s,secondary_color:r.target.value})),className:"flex-1 px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]})]})]}),e.jsx("div",{className:"flex gap-4 pt-6",children:e.jsx("button",{type:"submit",disabled:n,className:"px-6 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors disabled:bg-gray-400",children:n?"Saving...":"Save Colors"})})]}),e.jsxs("div",{className:"mt-8 p-6 rounded-lg",style:{background:`linear-gradient(to right, ${a.primary_color}, ${a.secondary_color})`},children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:"Color Preview"}),e.jsx("p",{className:"text-white mt-2",children:"This is how your colors will look together"})]})]}),g==="password"&&e.jsx("form",{onSubmit:k,children:e.jsxs("div",{className:"space-y-6 max-w-md",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Password *"}),e.jsx("input",{type:"password",name:"current_password",value:d.current_password,onChange:f,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"New Password *"}),e.jsx("input",{type:"password",name:"new_password",value:d.new_password,onChange:f,required:!0,minLength:6,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Minimum 6 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm New Password *"}),e.jsx("input",{type:"password",name:"confirm_password",value:d.confirm_password,onChange:f,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),e.jsx("div",{className:"flex gap-4 pt-4",children:e.jsx("button",{type:"submit",disabled:n,className:"px-6 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors disabled:bg-gray-400",children:n?"Changing...":"Change Password"})})]})})]})]})]})}export{T as default};
