import{j as e,h as Q,u as q,r as m,Q as G,k as W,V as X,i as Z,A as w}from"./index.UZcXu8dh.js";import{C as D}from"./CurrencySelector.D5bdgV-Y.js";import{C as ee}from"./calendar.C-ct2omj.js";import{C as U}from"./check.UMeoQl_X.js";import{C as se}from"./credit-card.C57WBUBh.js";function te({isOpen:v,onClose:h,onConfirm:t,title:_="Confirm Action",message:g,confirmText:l="Confirm",cancelText:o="Cancel",type:P="warning"}){if(!v)return null;const f={warning:{bg:"bg-yellow-100",icon:"text-yellow-600",button:"bg-yellow-600 hover:bg-yellow-700"},danger:{bg:"bg-red-100",icon:"text-red-600",button:"bg-red-600 hover:bg-red-700"},info:{bg:"bg-blue-100",icon:"text-blue-600",button:"bg-blue-600 hover:bg-blue-700"}}[P];return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`${f.bg} rounded-full p-3`,children:e.jsx(Q,{className:`w-6 h-6 ${f.icon}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:_}),e.jsx("p",{className:"text-sm text-gray-600 whitespace-pre-line",children:g})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 flex justify-end gap-3 rounded-b-lg",children:[e.jsx("button",{onClick:h,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:o}),e.jsx("button",{onClick:()=>{t(),h()},className:`px-4 py-2 text-sm font-medium text-white rounded-lg transition-colors ${f.button}`,children:l})]})]})})}function ie(){var E,L,A,F,M;q();const[v,h]=m.useState(!0),[t,_]=m.useState(null),[g,l]=m.useState(!1),[o,P]=m.useState("monthly"),[p,f]=m.useState([]),{toasts:R,removeToast:K,toast:x}=G(),[d,k]=m.useState({isOpen:!1,message:"",onConfirm:null}),{formatPrice:j}=W();m.useEffect(()=>{(async()=>{try{h(!0),await Promise.all([S(),I()])}catch(r){console.error("Error initializing:",r)}finally{h(!1)}})()},[]);const I=async()=>{try{const r=await(await fetch(`${w}/subscription/get-plans`,{credentials:"include"})).json();r.success&&f(r.plans||[])}catch(s){console.error("Error loading plans:",s)}},S=async()=>{var s,r,n,c,a,N,$,O;try{const i=await(await fetch(`${w}/subscription/get-status`,{credentials:"include"})).json();if(i.success){const Y={status:((s=i.subscription)==null?void 0:s.status)||"inactive",start_date:((r=i.current_subscription)==null?void 0:r.start_date)||null,end_date:((n=i.subscription)==null?void 0:n.end_date)||null,days_remaining:((c=i.subscription)==null?void 0:c.days_remaining)||0,is_active:((a=i.subscription)==null?void 0:a.is_active)||!1,trial_used:((N=i.subscription)==null?void 0:N.trial_used)||!1,plan_name:(($=i.current_subscription)==null?void 0:$.plan_name)||"SchoolHub Subscription",amount:((O=i.current_subscription)==null?void 0:O.amount)||5e3,payment_history:i.payment_history||[]};_(Y)}}catch(z){console.error("Error loading subscription:",z)}},B=async()=>{try{l(!0);const r=await(await fetch(`${w}/subscription/initialize-payment`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({plan_type:o})})).json();r.success&&r.authorization_url?window.location.href=r.authorization_url:x.error("Error initializing payment: "+(r.message||"Unknown error"))}catch(s){console.error("Payment error:",s),x.error("Failed to initialize payment. Please try again.")}finally{l(!1)}},T=s=>s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A",H=s=>{if(!s)return 0;const r=new Date(s),c=Math.ceil((r-new Date)/(1e3*60*60*24));return Math.max(0,c)};if(v)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})});const y=(t==null?void 0:t.status)==="active",C=(t==null?void 0:t.status)==="trialing",u=(t==null?void 0:t.days_remaining)||H(t==null?void 0:t.end_date),b=(E=t==null?void 0:t.plan_name)!=null&&E.toLowerCase().includes("yearly")?"yearly":(L=t==null?void 0:t.plan_name)!=null&&L.toLowerCase().includes("term")?"term":"monthly",J=y,V=async s=>{var r,n;try{l(!0);const a=await(await fetch(`${w}/subscription/change-plan`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({new_plan_type:s})})).json();if(a.success&&a.authorization_url)k({isOpen:!0,title:"Confirm Plan Change",message:a.message+`

Proceed to payment?`,confirmText:"Proceed to Payment",type:"info",onConfirm:()=>{window.location.href=a.authorization_url}}),l(!1);else if(a.success&&a.scheduled_change){const N=((r=a.info)==null?void 0:r.message)||"Plan change scheduled successfully!";x.success(N+`

`+(((n=a.info)==null?void 0:n.next_charge)||""),8e3),S(),l(!1)}else a.success?(x.success("Plan changed successfully!"),S(),l(!1)):(x.error("Error: "+(a.message||"Unknown error")),l(!1))}catch(c){console.error("Plan change error:",c),x.error("Failed to change plan. Please try again."),l(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(X,{toasts:R,removeToast:K}),e.jsx(te,{isOpen:d.isOpen,onClose:()=>k({...d,isOpen:!1}),onConfirm:d.onConfirm,title:d.title,message:d.message,confirmText:d.confirmText,type:d.type}),e.jsxs("div",{className:"max-w-6xl mx-auto px-2",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:"#1791C8"},children:"Subscription Management"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Manage your SchoolHub subscription"})]}),e.jsx(D,{})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-3",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white border rounded-lg overflow-hidden",style:{borderColor:"#1791C8"},children:[e.jsx("div",{className:"px-3 py-2",style:{backgroundColor:"#1791C8"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-bold text-white",children:"Current Plan"}),e.jsx("div",{className:`px-2 py-0.5 rounded-full text-xs font-semibold ${y?"bg-green-500 text-white":C?"bg-yellow-500 text-white":"bg-red-500 text-white"}`,children:((A=t==null?void 0:t.status)==null?void 0:A.toUpperCase())||"INACTIVE"})]})}),e.jsxs("div",{className:"p-3 space-y-2",children:[(t==null?void 0:t.start_date)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-3.5 h-3.5",style:{color:"#1791C8"}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Start"}),e.jsx("p",{className:"text-xs font-semibold",children:T(t.start_date)})]})]}),(t==null?void 0:t.end_date)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-3.5 h-3.5",style:{color:"#1791C8"}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-gray-500",children:C?"Trial Ends":"Next Payment"}),e.jsx("p",{className:"text-xs font-semibold",children:T(t.end_date)})]})]}),(y||C)&&u>0&&e.jsx("div",{className:`p-2 rounded border text-center ${u<=7?"bg-yellow-50 border-yellow-200":""}`,style:u>7?{borderColor:"#1791C8",backgroundColor:"#E6F4F9"}:{},children:e.jsxs("p",{className:`text-xs font-bold ${u<=7?"text-yellow-900":""}`,style:u>7?{color:"#1791C8"}:{},children:[u," days left"]})})]})]})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsxs("div",{className:"bg-white border rounded-lg overflow-hidden",style:{borderColor:"#1791C8"},children:[!y&&e.jsxs("div",{className:"border-b p-3",style:{borderColor:"#1791C8"},children:[e.jsx("h3",{className:"text-sm font-bold mb-2",style:{color:"#1791C8"},children:"Choose Your Plan"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:p.map((s,r)=>{const n=s.plan_name.toLowerCase().includes("yearly")?"yearly":s.plan_name.toLowerCase().includes("term")?"term":"monthly",c=n==="term",a=n==="term"?Math.round(s.amount/4):n==="yearly"?Math.round(s.amount/12):null;return e.jsxs("button",{onClick:()=>P(n),className:`p-2 rounded border transition-all text-center ${o===n?"":"border-gray-200 hover:border-gray-300"}`,style:o===n?{borderColor:"#1791C8",backgroundColor:"#E6F4F9"}:{},children:[c&&e.jsx("span",{className:"text-xs font-bold block mb-1",style:{color:"#1791C8"},children:"POPULAR"}),e.jsx("div",{className:"text-xs font-semibold text-gray-700",children:s.plan_name}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:j(s.amount)}),a&&e.jsxs("div",{className:"text-xs text-gray-500",children:[j(a),"/mo"]}),o===n&&e.jsx(U,{className:"w-4 h-4 mx-auto mt-1",style:{color:"#1791C8"}})]},s.id)})})]}),e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold",style:{color:"#1791C8"},children:((F=p.find(s=>(s.plan_name.toLowerCase().includes("yearly")?"yearly":s.plan_name.toLowerCase().includes("term")?"term":"monthly")===o))==null?void 0:F.plan_name)||"Selected Plan"}),e.jsx("p",{className:"text-xs text-gray-600",children:"All features included"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"#1791C8"},children:j(((M=p.find(s=>(s.plan_name.toLowerCase().includes("yearly")?"yearly":s.plan_name.toLowerCase().includes("term")?"term":"monthly")===o))==null?void 0:M.amount)||0)}),e.jsx("div",{className:"text-xs text-gray-600",children:o==="yearly"?"per year":o==="term"?"per term":"per month"})]})]}),e.jsx("div",{className:"border-t pt-2 mb-3",style:{borderColor:"#1791C8"},children:e.jsx("div",{className:"grid grid-cols-2 gap-x-3 gap-y-1",children:["Unlimited Report Cards","Student Management","Teacher Management","Attendance Tracking","Custom Branding","Analytics Dashboard","PDF Export","Email Support"].map((s,r)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"w-3 h-3 flex-shrink-0",style:{color:"#1791C8"}}),e.jsx("span",{className:"text-xs text-gray-700",children:s})]},r))})}),!y&&e.jsxs("button",{onClick:B,disabled:g,className:"w-full px-4 py-2 text-white rounded-lg transition-all font-semibold flex items-center justify-center gap-2 disabled:opacity-50",style:{backgroundColor:"#1791C8"},children:[e.jsx(se,{className:"w-4 h-4"}),g?"Processing...":C||t!=null&&t.trial_used?"Subscribe Now":"Start 7-Day Free Trial"]}),y&&e.jsxs("div",{children:[e.jsx("div",{className:"border rounded p-2 mb-2",style:{borderColor:"#1791C8",backgroundColor:"#E6F4F9"},children:e.jsxs("p",{className:"text-xs font-semibold",style:{color:"#1791C8"},children:["Active ",b==="yearly"?"Yearly":b==="term"?"Per Term":"Monthly"," Subscription"]})}),J&&e.jsx("div",{className:"space-y-2",children:p.filter(s=>(s.plan_name.toLowerCase().includes("yearly")?"yearly":s.plan_name.toLowerCase().includes("term")?"term":"monthly")!==b).map(s=>{const r=s.plan_name.toLowerCase().includes("yearly")?"yearly":s.plan_name.toLowerCase().includes("term")?"term":"monthly",n=b==="monthly"&&(r==="term"||r==="yearly")||b==="term"&&r==="yearly";return e.jsxs("button",{onClick:()=>V(r),disabled:g,className:"w-full px-3 py-2 text-white rounded text-sm font-semibold flex items-center justify-between disabled:opacity-50 transition-opacity",style:{backgroundColor:n?"#1791C8":"#6b7280"},children:[e.jsxs("span",{children:[n?"Upgrade":"Switch"," to ",s.plan_name]}),e.jsx("span",{children:j(s.amount)})]},s.id)})})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center mt-2",children:"Secure payment by Paystack â€¢ Cancel anytime"})]})]})})]})]})]})}export{ie as default};
