import{c as V,w as z,r as l,j as e,S as B,x as f,U as N,a1 as v,a2 as I,n as w,i as R,C as O}from"./index.UZcXu8dh.js";import{S as q,T as G,U as X,V as H}from"./api.CIjYu6Aj.js";import{S as J}from"./search.CQM06eWW.js";import{E as K}from"./eye.DHnN3T_-.js";import{C as Q}from"./chevron-left.BCC_ZOV5.js";import{M as W}from"./mail.B-H7KAXZ.js";import{P as Y}from"./phone.BXg1GupO.js";import{M as Z}from"./map-pin.CD03Yg76.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],se=V("power",ee);function oe(){const{toast:c}=z(),[b,S]=l.useState([]),[_,j]=l.useState(!0),[h,C]=l.useState(""),[x,k]=l.useState(""),[i,n]=l.useState(1),[r,M]=l.useState(null),[t,D]=l.useState(null),[F,p]=l.useState(!1),[A,u]=l.useState(!1),[d,g]=l.useState({subscription_status:"",subscription_end_date:""});l.useEffect(()=>{m()},[i,x]);const m=async()=>{try{j(!0);const s={page:i,limit:20};x&&(s.status=x),h&&(s.search=h);const a=await q(s);S(a.schools||[]),M(a.pagination)}catch(s){console.error("Failed to fetch schools:",s),c.error("Failed to load schools")}finally{j(!1)}},E=s=>{s.preventDefault(),n(1),m()},P=async s=>{try{const a=await G(s.id);D(a),p(!0)}catch(a){console.error("Failed to fetch school details:",a),c.error("Failed to load school details")}},T=async(s,a)=>{if(confirm(`Are you sure you want to ${a?"deactivate":"activate"} this school?`))try{await X(s,!a),c.success(`School ${a?"deactivated":"activated"} successfully`),m()}catch(o){console.error("Failed to toggle school status:",o),c.error("Failed to update school status")}},U=async s=>{s.preventDefault();try{await H(t.school.id,d.subscription_status,d.subscription_end_date),c.success("Subscription updated successfully"),u(!1),p(!1),m()}catch(a){console.error("Failed to update subscription:",a),c.error("Failed to update subscription")}},L=s=>{g({subscription_status:s.subscription_status,subscription_end_date:s.subscription_end_date||""}),u(!0)},y=s=>{const a={active:{bg:"bg-green-100",text:"text-green-800",icon:O},trial:{bg:"bg-yellow-100",text:"text-yellow-800",icon:R},expired:{bg:"bg-red-100",text:"text-red-800",icon:w}},o=a[s]||a.expired,$=o.icon;return e.jsxs("span",{className:`px-2 py-1 inline-flex items-center text-xs leading-5 font-semibold rounded-full ${o.bg} ${o.text}`,children:[e.jsx($,{className:"h-3 w-3 mr-1"}),s]})};return e.jsxs(e.Fragment,{children:[e.jsx(B,{title:"Manage Schools"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Schools Management"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"View and manage all schools in the system"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("form",{onSubmit:E,className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by school name, email, or phone...",value:h,onChange:s=>C(s.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})}),e.jsx("div",{className:"md:w-48",children:e.jsxs("select",{value:x,onChange:s=>{k(s.target.value),n(1)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"trial",children:"Trial"}),e.jsx("option",{value:"expired",children:"Expired"})]})}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:"Search"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:_?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):b.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No schools found"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"School"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subscription"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stats"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-primary-600 font-bold",children:s.school_name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.school_name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${s.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.is_active?"Active":"Inactive"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[y(s.subscription_status),s.subscription_end_date&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Until ",new Date(s.subscription_end_date).toLocaleDateString()]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(f,{className:"h-4 w-4 mr-1"}),s.total_students]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(N,{className:"h-4 w-4 mr-1"}),s.total_teachers]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{className:"h-4 w-4 mr-1"}),s.total_classes]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>P(s),className:"text-purple-600 hover:text-purple-900",title:"View Details",children:e.jsx(K,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>T(s.id,s.is_active),className:`${s.is_active?"text-red-600 hover:text-red-900":"text-green-600 hover:text-green-900"}`,title:s.is_active?"Deactivate":"Activate",children:e.jsx(se,{className:"h-5 w-5"})})]})})]},s.id))})]})}),r&&r.total_pages>1&&e.jsxs("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>n(s=>Math.max(1,s-1)),disabled:i===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>n(s=>Math.min(r.total_pages,s+1)),disabled:i===r.total_pages,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed",children:"Next"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",e.jsx("span",{className:"font-medium",children:(i-1)*r.per_page+1})," to"," ",e.jsx("span",{className:"font-medium",children:Math.min(i*r.per_page,r.total_items)})," ","of ",e.jsx("span",{className:"font-medium",children:r.total_items})," results"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[e.jsx("button",{onClick:()=>n(s=>Math.max(1,s-1)),disabled:i===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed",children:e.jsx(Q,{className:"h-5 w-5"})}),e.jsxs("span",{className:"relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700",children:["Page ",i," of ",r.total_pages]}),e.jsx("button",{onClick:()=>n(s=>Math.min(r.total_pages,s+1)),disabled:i===r.total_pages,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed",children:e.jsx(I,{className:"h-5 w-5"})})]})})]})]})]})}),F&&t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between sticky top-0 bg-white",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t.school.school_name}),e.jsx("button",{onClick:()=>p(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(w,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(W,{className:"h-5 w-5 text-gray-400 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),e.jsx("p",{className:"font-medium",children:t.school.email})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(Y,{className:"h-5 w-5 text-gray-400 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Phone"}),e.jsx("p",{className:"font-medium",children:t.school.phone||"N/A"})]})]}),e.jsxs("div",{className:"flex items-start md:col-span-2",children:[e.jsx(Z,{className:"h-5 w-5 text-gray-400 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Address"}),e.jsx("p",{className:"font-medium",children:t.school.address||"N/A"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg text-center",children:[e.jsx(f,{className:"h-8 w-8 text-purple-600 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.school.total_students}),e.jsx("p",{className:"text-sm text-gray-600",children:"Students"})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[e.jsx(N,{className:"h-8 w-8 text-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.school.total_teachers}),e.jsx("p",{className:"text-sm text-gray-600",children:"Teachers"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[e.jsx(v,{className:"h-8 w-8 text-green-600 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.school.total_classes}),e.jsx("p",{className:"text-sm text-gray-600",children:"Classes"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Subscription Details"}),e.jsx("button",{onClick:()=>L(t.school),className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 text-sm",children:"Update Subscription"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Status"}),e.jsx("p",{className:"mt-1",children:y(t.school.subscription_status)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"End Date"}),e.jsx("p",{className:"font-medium mt-1",children:t.school.subscription_end_date?new Date(t.school.subscription_end_date).toLocaleDateString():"N/A"})]})]})]}),t.recent_students&&t.recent_students.length>0&&e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Recent Students"}),e.jsx("div",{className:"space-y-2",children:t.recent_students.slice(0,5).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.class," - ",s.admission_no]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(s.created_at).toLocaleDateString()})]},s.id))})]})]})]})}),A&&t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Update Subscription"})}),e.jsxs("form",{onSubmit:U,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subscription Status"}),e.jsxs("select",{value:d.subscription_status,onChange:s=>g({...d,subscription_status:s.target.value}),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Select status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"trial",children:"Trial"}),e.jsx("option",{value:"expired",children:"Expired"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subscription End Date"}),e.jsx("input",{type:"date",value:d.subscription_end_date,onChange:s=>g({...d,subscription_end_date:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:"Update"})]})]})]})})]})]})}export{oe as default};
