import{r,j as e}from"./index.UZcXu8dh.js";import{t as ae,k as te,l as re,v as ne,w as le,x as R,y as ce}from"./api.CIjYu6Aj.js";const oe=()=>{const[f,I]=r.useState([]),[k,h]=r.useState(!0),[E,l]=r.useState(""),[F,d]=r.useState(""),[M,y]=r.useState(!1),[O,N]=r.useState(!1),[B,v]=r.useState(!1),[o,w]=r.useState(null),[C,S]=r.useState(null),[A,x]=r.useState([]),[G,H]=r.useState([]),[J,U]=r.useState([]),[D,K]=r.useState(""),[c,$]=r.useState("full_class"),[p,q]=r.useState({name:"",email:"",password:"",phone:"",classes:[]}),[n,T]=r.useState({class_name:"",session:"",term:"",subject:""}),[m,u]=r.useState([]);r.useEffect(()=>{b(),Q()},[]);const b=async()=>{h(!0);try{const s=await ae();s.success?I(s.teachers||[]):l("Failed to load teachers")}catch(s){l("Error loading teachers"),console.error("Load teachers error:",s)}finally{h(!1)}},Q=async()=>{try{const s=await te();if(s.success){const t=[...new Set((s.classes||[]).map(g=>g.class_name))],i=[...new Set((s.classes||[]).map(g=>g.session))];H(t),U(i)}const a=await re();a.success&&a.data.current_session&&(K(a.data.current_session),U(t=>t.includes(a.data.current_session)?t:[a.data.current_session,...t]))}catch(s){console.error("Error loading classes and sessions:",s)}},j=s=>{q({...p,[s.target.name]:s.target.value})},V=async s=>{s.preventDefault(),l(""),d("");try{const a=await ne(p);a.success?(d("Teacher created successfully!"),y(!1),q({name:"",email:"",password:"",phone:"",classes:[]}),b(),setTimeout(()=>d(""),3e3)):l(a.message||"Failed to create teacher")}catch(a){l("Error creating teacher"),console.error("Create teacher error:",a)}},P=s=>{S(s),N(!0),$("full_class"),x([]),u([]),T({class_name:"",session:D||"",term:"",subject:""})},_=async s=>{const{name:a,value:t}=s.target;if(T({...n,[a]:t}),a==="class_name"&&t&&c==="subject"){h(!0);try{const i=await R(t);i.success?x(i.data.subjects||[]):x([])}catch(i){console.error("Error loading subjects:",i),x([])}finally{h(!1)}}},L=async s=>{if($(s),T({...n,subject:""}),u([]),s==="subject"&&n.class_name){h(!0);try{const a=await R(n.class_name);a.success?x(a.data.subjects||[]):x([])}catch(a){console.error("Error loading subjects:",a),x([])}finally{h(!1)}}else s==="full_class"&&x([])},W=s=>{m.includes(s)?u(m.filter(a=>a!==s)):u([...m,s])},X=()=>{const s=A.map(a=>a.name);u(s)},Y=()=>{u([])},Z=async s=>{if(s.preventDefault(),l(""),d(""),c==="subject"&&m.length===0){l("Please select at least one subject");return}try{let a=[];c==="full_class"?a=[n]:a=m.map(i=>({class_name:n.class_name,session:n.session,term:n.term,subject:i}));const t=await le({teacher_id:C.id,classes:a});if(t.success){const i=c==="subject"?m.length:0,g=c==="subject"?`Class assigned successfully with ${i} subject(s)!`:"Class assigned successfully!";d(g),N(!1),S(null),u([]),b(),setTimeout(()=>d(""),3e3)}else l(t.message||"Failed to assign class")}catch(a){l("Error assigning class"),console.error("Assign class error:",a)}},z=(s,a)=>{w({teacher:s,classAssignment:a}),v(!0)},ee=async()=>{if(!o)return;const{teacher:s,classAssignment:a}=o;v(!1),l(""),d("");try{const t=await ce({teacher_id:s.id,class_name:a.class_name,session:a.session,term:a.term,subject:a.subject||null});t.success?(d("Class unassigned successfully!"),b(),setTimeout(()=>d(""),3e3)):l(t.message||"Failed to unassign class")}catch(t){l("Error unassigning class"),console.error("Unassign class error:",t)}finally{w(null)}},se=()=>{v(!1),w(null)};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Manage Teachers"}),e.jsx("button",{onClick:()=>y(!0),className:"bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md text-sm font-medium",children:"Add New Teacher"})]}),e.jsxs("div",{children:[E&&e.jsx("div",{className:"bg-red-50 border border-red-400 text-red-700 px-4 py-3 rounded mb-6",children:E}),F&&e.jsx("div",{className:"bg-green-50 border border-green-400 text-green-700 px-4 py-3 rounded mb-6",children:F}),M&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Create New Teacher"})}),e.jsxs("form",{onSubmit:V,className:"p-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name *"}),e.jsx("input",{type:"text",name:"name",required:!0,value:p.name,onChange:j,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500",placeholder:"Enter teacher's name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),e.jsx("input",{type:"email",name:"email",required:!0,value:p.email,onChange:j,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500",placeholder:"teacher@school.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password *"}),e.jsx("input",{type:"password",name:"password",required:!0,value:p.password,onChange:j,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500",placeholder:"Create a password"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),e.jsx("input",{type:"tel",name:"phone",value:p.phone,onChange:j,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500",placeholder:"Phone number"})]})]}),e.jsxs("div",{className:"mt-6 flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>y(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700",children:"Create Teacher"})]})]})]})}),O&&C&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Assign Class to ",C.name]})}),e.jsxs("form",{onSubmit:Z,className:"p-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assignment Type *"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>L("full_class"),className:`px-4 py-2 rounded-md text-sm font-medium ${c==="full_class"?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Full Class"}),e.jsx("button",{type:"button",onClick:()=>L("subject"),className:`px-4 py-2 rounded-md text-sm font-medium ${c==="subject"?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Specific Subject"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:c==="full_class"?"Teacher will see all students in the class":"Teacher will only see students enrolled in the selected subject"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Class Name *"}),e.jsxs("select",{name:"class_name",required:!0,value:n.class_name,onChange:_,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"",children:"Select class"}),G.map((s,a)=>e.jsx("option",{value:s,children:s},a))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Session *"}),e.jsxs("select",{name:"session",required:!0,value:n.session,onChange:_,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"",children:"Select session"}),J.map((s,a)=>e.jsxs("option",{value:s,children:[s,s===D?" (Current)":""]},a))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Term (Optional)"}),e.jsxs("select",{name:"term",value:n.term,onChange:_,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"",children:"All Terms"}),e.jsx("option",{value:"First Term",children:"First Term"}),e.jsx("option",{value:"Second Term",children:"Second Term"}),e.jsx("option",{value:"Third Term",children:"Third Term"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:'Leave as "All Terms" to assign across all terms'})]}),c==="subject"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subjects * (Select one or more)"}),m.length>0&&e.jsxs("span",{className:"text-xs text-primary-600 font-medium",children:[m.length," selected"]})]}),k&&n.class_name?e.jsx("p",{className:"text-sm text-gray-500 italic",children:"Loading subjects..."}):A.length===0?e.jsx("p",{className:"text-sm text-gray-500 italic",children:n.class_name?"No subjects configured for this class. Please configure class subjects first.":"Select class name first to load available subjects"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2 mb-2 text-xs",children:[e.jsx("button",{type:"button",onClick:X,className:"text-primary-600 hover:text-primary-700 font-medium",children:"Select All"}),e.jsx("span",{className:"text-gray-300",children:"|"}),e.jsx("button",{type:"button",onClick:Y,className:"text-gray-600 hover:text-gray-700 font-medium",children:"Deselect All"})]}),e.jsx("div",{className:"border border-gray-300 rounded-md p-3 max-h-48 overflow-y-auto space-y-2",children:A.map((s,a)=>{const t=m.includes(s.name);return e.jsxs("label",{className:`flex items-center p-2 rounded-md cursor-pointer transition-colors ${t?"bg-primary-50 border border-primary-500":"bg-gray-50 border border-transparent hover:bg-gray-100"}`,children:[e.jsx("input",{type:"checkbox",checked:t,onChange:()=>W(s.name),className:"mr-2 h-4 w-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-gray-900 font-medium text-sm",children:s.name}),e.jsx("span",{className:`ml-2 text-xs px-2 py-0.5 rounded ${s.is_core?"bg-primary-100 text-primary-700":"bg-gray-200 text-gray-700"}`,children:s.is_core?"Core":"Elective"})]})]},a)})})]})]})]}),e.jsxs("div",{className:"mt-6 flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{N(!1),S(null)},className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700",children:["Assign ",c==="full_class"?"Class":"Subject"]})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"px-3 sm:px-6 py-3 sm:py-4 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:"All Teachers"})}),e.jsx("div",{className:"p-3 sm:p-6",children:k?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading teachers..."})]}):f.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-600",children:"No teachers found"}),e.jsx("button",{onClick:()=>y(!0),className:"mt-4 text-primary-600 hover:text-primary-700 font-medium",children:"Create your first teacher"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block md:hidden space-y-3",children:f.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-gray-900 text-sm",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 truncate",children:s.email}),e.jsx("p",{className:"text-xs text-gray-500",children:s.phone||"N/A"})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium whitespace-nowrap ml-2 ${s.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.is_active?"Active":"Inactive"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"Assigned Classes"}),s.classes&&s.classes.length>0?e.jsx("div",{className:"space-y-1",children:s.classes.map((a,t)=>e.jsxs("div",{className:"flex items-center justify-between text-xs bg-gray-50 p-2 rounded",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-gray-900",children:a.class_name}),a.subject&&e.jsx("span",{className:"ml-1 px-1.5 py-0.5 bg-primary-100 text-primary-700 rounded text-xs",children:a.subject}),e.jsxs("div",{className:"text-gray-500 text-xs mt-0.5",children:[a.session," - ",a.term||"All Terms"]})]}),e.jsx("button",{onClick:()=>z(s,a),className:"ml-2 text-red-600 hover:text-red-700 text-xs font-medium whitespace-nowrap",children:"Unassign Class"})]},t))}):e.jsx("span",{className:"text-xs text-gray-400",children:"No classes assigned"})]}),e.jsx("button",{onClick:()=>P(s),className:"w-full text-center py-2 px-3 bg-primary-50 text-primary-600 rounded-md hover:bg-primary-100 font-medium text-sm",children:"Assign Class/Subject"})]},s.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Assigned Classes"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.phone||"N/A"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:s.classes&&s.classes.length>0?e.jsx("div",{className:"space-y-1",children:s.classes.map((a,t)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-2 rounded text-xs",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-gray-900",children:a.class_name}),a.subject&&e.jsx("span",{className:"ml-1 px-1.5 py-0.5 bg-primary-100 text-primary-700 rounded text-xs",children:a.subject}),e.jsxs("span",{className:"text-gray-500",children:[" (",a.session," - ",a.term||"All Terms",")"]})]}),e.jsx("button",{onClick:()=>z(s,a),className:"ml-2 text-red-600 hover:text-red-700 text-xs font-medium whitespace-nowrap",children:"Unassign Class"})]},t))}):e.jsx("span",{className:"text-gray-400",children:"No classes assigned"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.is_active?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm",children:e.jsx("button",{onClick:()=>P(s),className:"text-primary-600 hover:text-primary-900 font-medium",children:"Assign Class/Subject"})})]},s.id))})]})})]})})]})]}),B&&o&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Confirm Unassignment"})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("p",{className:"text-gray-700",children:["Are you sure you want to unassign"," ",e.jsxs("span",{className:"font-semibold",children:[o.classAssignment.class_name,o.classAssignment.subject&&` - ${o.classAssignment.subject}`]})," ","from"," ",e.jsx("span",{className:"font-semibold",children:o.teacher.name}),"?"]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Session: ",o.classAssignment.session," | Term: ",o.classAssignment.term||"All Terms"]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 flex gap-3 justify-end rounded-b-lg",children:[e.jsx("button",{type:"button",onClick:se,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 font-medium",children:"Cancel"}),e.jsx("button",{type:"button",onClick:ee,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md font-medium",children:"Unassign"})]})]})})]})};export{oe as default};
