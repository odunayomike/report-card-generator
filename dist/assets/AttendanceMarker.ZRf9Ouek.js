import{I as $,r,j as e}from"./index.UZcXu8dh.js";import{O,r as R,P as L}from"./api.CIjYu6Aj.js";const G=()=>{const{classes:u}=$(),[p,S]=r.useState([]),[t,A]=r.useState(null),[l,f]=r.useState([]),[o,m]=r.useState({}),[i,k]=r.useState(new Date().toISOString().split("T")[0]),[C,b]=r.useState(!1),[g,y]=r.useState(!1),[j,d]=r.useState(""),[N,h]=r.useState("");r.useEffect(()=>{u&&S(u)},[u]),r.useEffect(()=>{t&&i&&E()},[t,i]);const E=async()=>{if(t){b(!0),d("");try{const[s,a]=await Promise.all([O({class_name:t.class_name,session:t.session,term:t.term}),R({date:i,class_name:t.class_name,session:t.session,term:t.term})]);if(s.success){const n=s.students||[];if(f(n),n.length===0){d(`No students found for ${t.class_name} - ${t.session} - ${t.term}`);return}const c={};n.forEach(x=>{c[x.id]="present"}),a.success&&a.data&&a.data.forEach(x=>{c[x.student_id]=x.status}),m(c)}else{const n=s.message||"Failed to load students";d(n),console.error("Students API error:",n)}}catch(s){const a=s.message||"Error loading data";d(`Error loading data: ${a}`),console.error("Load data error:",s)}finally{b(!1)}}},_=s=>{const a=s.target.value,n=p.find(c=>c.id==a);A(n||null),f([]),m({})},v=(s,a)=>{m(n=>({...n,[s]:a}))},w=s=>{const a={};l.forEach(n=>{a[n.id]=s}),m(a)},D=async s=>{if(s.preventDefault(),!t){d("Please select a class");return}if(l.length===0){d("No students to mark attendance for");return}y(!0),d(""),h("");try{const a=l.map(c=>({student_id:c.id,status:o[c.id]||"present"})),n=await L({date:i,attendance:a});n.success?(h("Attendance marked successfully!"),setTimeout(()=>h(""),3e3)):d(n.message||"Failed to mark attendance")}catch(a){d("Error marking attendance"),console.error("Mark attendance error:",a)}finally{y(!1)}},M=Object.values(o).filter(s=>s==="present").length,P=Object.values(o).filter(s=>s==="absent").length;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Mark Attendance"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Record daily student attendance for your classes"})]}),e.jsxs("div",{children:[j&&e.jsx("div",{className:"bg-red-50 border border-red-400 text-red-700 px-4 py-3 rounded mb-6",children:j}),N&&e.jsx("div",{className:"bg-green-50 border border-green-400 text-green-700 px-4 py-3 rounded mb-6",children:N}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Class"}),e.jsxs("select",{value:(t==null?void 0:t.id)||"",onChange:_,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"",children:"-- Select a class --"}),p.map(s=>e.jsxs("option",{value:s.id,children:[s.class_name," - ",s.session," (",s.term,")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Date"}),e.jsx("input",{type:"date",value:i,onChange:s=>k(s.target.value),max:new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]})]})}),t&&e.jsxs("form",{onSubmit:D,children:[e.jsxs("div",{className:"bg-white rounded-lg shadow mb-6",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:[t.class_name," - ",i]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Total: ",l.length," | Present: ",M," | Absent: ",P]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>w("present"),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md text-sm font-medium",children:"Mark All Present"}),e.jsx("button",{type:"button",onClick:()=>w("absent"),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md text-sm font-medium",children:"Mark All Absent"})]})]}),e.jsx("div",{className:"p-6",children:C?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading students..."})]}):l.length===0?e.jsx("p",{className:"text-gray-600 text-center py-12",children:"No students found for this class"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Admission No"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Student Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Gender"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Attendance"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.admission_no}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.gender}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:`attendance-${s.id}`,value:"present",checked:o[s.id]==="present",onChange:()=>v(s.id,"present"),className:"form-radio h-4 w-4 text-green-600 focus:ring-green-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Present"})]}),e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:`attendance-${s.id}`,value:"absent",checked:o[s.id]==="absent",onChange:()=>v(s.id,"absent"),className:"form-radio h-4 w-4 text-red-600 focus:ring-red-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Absent"})]})]})})]},s.id))})]})})})]}),l.length>0&&e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:g,className:`px-6 py-3 rounded-md text-white font-medium ${g?"bg-green-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}`,children:g?"Saving...":"Save Attendance"})})]})]})]})};export{G as default};
