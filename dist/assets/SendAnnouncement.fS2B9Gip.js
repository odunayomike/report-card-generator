import{r as t,A as C,j as e,U as z,F as B}from"./index.UZcXu8dh.js";import{S as D}from"./school.DqsqQsMi.js";import{D as W}from"./dollar-sign.JS32PwXk.js";function F(){const[r,n]=t.useState({title:"",message:"",recipientType:"all",selectedParent:""}),[f,m]=t.useState(!1),[y,j]=t.useState(!1),[L,x]=t.useState(!1),[b,l]=t.useState(""),[c,h]=t.useState(null),[p,P]=t.useState([]),[u,i]=t.useState(""),[v,g]=t.useState(!1);t.useEffect(()=>{S()},[]);const S=async()=>{j(!0);try{const a=await(await fetch(`${C}/parent/get-all-parents`,{credentials:"include"})).json();a.success&&P(a.parents||[])}catch(s){console.error("Failed to fetch parents:",s)}finally{j(!1)}},T=async s=>{s.preventDefault(),m(!0),l(""),x(!1),h(null);try{const a={title:r.title,message:r.message};if(r.recipientType==="specific"){if(!r.selectedParent){l("Please select a parent to send to"),m(!1);return}a.parent_id=r.selectedParent}const d=await(await fetch(`${C}/parent/notifications/send-announcement`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(a)})).json();d.success?(x(!0),h({sent:d.sent_count||0,failed:d.failed_count||0}),n({title:"",message:"",recipientType:"all",selectedParent:""}),i("")):l(d.message||"Failed to send announcement")}catch(a){l("An error occurred while sending the announcement"),console.error("Send announcement error:",a)}finally{m(!1)}},N=s=>{n({...r,[s.target.name]:s.target.value})},M=s=>{n({...r,title:s.title,message:s.message})},w=p.filter(s=>s.full_name&&s.full_name.toLowerCase().includes(u.toLowerCase())||s.email&&s.email.toLowerCase().includes(u.toLowerCase())),o=p.find(s=>s.id===parseInt(r.selectedParent)),A=[{title:"School Closure Notice",message:`Dear Parents,

Please be informed that the school will be closed on [DATE] due to [REASON]. Regular classes will resume on [DATE].

Thank you for your understanding.`,icon:D,color:"text-red-500",bgColor:"bg-red-50"},{title:"Parent-Teacher Meeting",message:`Dear Parents,

You are invited to our Parent-Teacher Meeting scheduled for [DATE] at [TIME]. We look forward to discussing your child's progress.

Kindly confirm your attendance.`,icon:z,color:"text-blue-500",bgColor:"bg-blue-50"},{title:"Fee Payment Reminder",message:`Dear Parents,

This is a reminder that school fees for the current term are due by [DATE]. Please ensure payment is made to avoid any inconvenience.

Thank you for your cooperation.`,icon:W,color:"text-green-500",bgColor:"bg-green-50"},{title:"Report Cards Available",message:`Dear Parents,

Report cards for the current term are now available in the parent app. Please log in to view your child's academic progress.

Best regards,
School Management`,icon:B,color:"text-purple-500",bgColor:"bg-purple-50"}];return e.jsx("div",{className:"bg-white p-4 h-[calc(100vh-64px)] overflow-hidden",children:e.jsxs("div",{className:"max-w-7xl mx-auto h-full flex flex-col",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-primary-500 to-primary-600 rounded-xl flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Send Announcement to Parents"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Broadcast messages or send to specific parents"})]})]})}),L&&c&&e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-l-4 border-green-500 rounded-lg p-3 mb-3 animate-fadeIn",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-green-900",children:"Announcement sent successfully!"}),e.jsxs("p",{className:"text-sm text-green-800",children:["Delivered to ",e.jsx("span",{className:"font-bold",children:c.sent})," parent(s)",c.failed>0&&e.jsxs("span",{className:"text-red-600 ml-2",children:["(",c.failed," failed)"]})]})]})]})}),b&&e.jsx("div",{className:"bg-gradient-to-r from-red-50 to-rose-50 border-l-4 border-red-500 rounded-lg p-3 mb-3 animate-fadeIn",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{className:"w-8 h-8 bg-red-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-900",children:"Error"}),e.jsx("p",{className:"text-sm text-red-800",children:b})]})]})}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-4 flex-1 overflow-y-auto",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary-500 to-primary-600 px-4 py-3 rounded-t-xl",children:e.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Compose Announcement"]})}),e.jsxs("form",{onSubmit:T,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Send To"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>n({...r,recipientType:"all",selectedParent:""}),className:`p-3 rounded-lg border-2 transition-all ${r.recipientType==="all"?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${r.recipientType==="all"?"bg-primary-500":"bg-gray-200"}`,children:e.jsx("svg",{className:`w-5 h-5 ${r.recipientType==="all"?"text-white":"text-gray-500"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:`font-semibold text-sm ${r.recipientType==="all"?"text-primary-700":"text-gray-700"}`,children:"All Parents"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Broadcast to everyone"})]})]})}),e.jsx("button",{type:"button",onClick:()=>n({...r,recipientType:"specific"}),className:`p-3 rounded-lg border-2 transition-all ${r.recipientType==="specific"?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${r.recipientType==="specific"?"bg-primary-500":"bg-gray-200"}`,children:e.jsx("svg",{className:`w-5 h-5 ${r.recipientType==="specific"?"text-white":"text-gray-500"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:`font-semibold text-sm ${r.recipientType==="specific"?"text-primary-700":"text-gray-700"}`,children:"Specific Parent"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Choose recipient"})]})]})})]})]}),r.recipientType==="specific"&&e.jsxs("div",{className:"animate-fadeIn",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["Select Parent ",e.jsx("span",{className:"text-red-500",children:"*"})]}),y?e.jsx("div",{className:"flex items-center justify-center py-3",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-500"})}):e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:u,onChange:s=>{i(s.target.value),g(!0)},onFocus:()=>g(!0),placeholder:"Search parent by name or email...",className:"w-full px-4 py-2 pr-10 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all"}),e.jsx("svg",{className:"w-5 h-5 text-gray-400 absolute right-3 top-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),o&&!v&&e.jsxs("div",{className:"mt-2 p-2 bg-primary-50 border border-primary-200 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold text-sm",children:o.full_name?o.full_name.charAt(0):"P"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm text-gray-900",children:o.full_name||"Unknown"}),e.jsx("p",{className:"text-xs text-gray-600",children:o.email||"No email"})]})]}),e.jsx("button",{type:"button",onClick:()=>{n({...r,selectedParent:""}),i("")},className:"text-red-500 hover:text-red-700",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),v&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border-2 border-gray-200 rounded-lg max-h-48 overflow-y-auto",children:w.length>0?w.map(s=>e.jsxs("button",{type:"button",onClick:()=>{n({...r,selectedParent:s.id.toString()}),i(s.full_name),g(!1)},className:"w-full text-left px-3 py-2 hover:bg-primary-50 transition-colors border-b border-gray-100 last:border-b-0",children:[e.jsx("p",{className:"font-semibold text-sm text-gray-900",children:s.full_name||"Unknown"}),e.jsxs("p",{className:"text-xs text-gray-600",children:[s.email||"No email"," • ",s.children_count||0," child(ren)"]})]},s.id)):e.jsx("div",{className:"px-3 py-4 text-center text-sm text-gray-500",children:"No parents found"})})]}),p.length===0&&!y&&e.jsxs("p",{className:"text-sm text-amber-600 mt-2 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),"No parents found. Please add parents first."]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"title",className:"block text-sm font-semibold text-gray-700 mb-2",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"title",name:"title",value:r.title,onChange:N,required:!0,maxLength:100,placeholder:"e.g., School Closure Notice",className:"w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1 text-right",children:[r.title.length,"/100"]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"message",className:"block text-sm font-semibold text-gray-700 mb-2",children:["Message ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:"message",name:"message",value:r.message,onChange:N,required:!0,rows:6,maxLength:500,placeholder:"Write your announcement message here...",className:"w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all resize-none"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1 text-right",children:[r.message.length,"/500"]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"submit",disabled:f||!r.title||!r.message,className:"flex-1 bg-gradient-to-r from-primary-500 to-primary-600 text-white py-2.5 px-4 rounded-lg font-semibold hover:from-primary-600 hover:to-primary-700 disabled:from-gray-300 disabled:to-gray-300 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2",children:f?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),"Send Announcement"]})}),e.jsx("button",{type:"button",onClick:()=>{n({title:"",message:"",recipientType:"all",selectedParent:""}),i(""),l(""),x(!1),h(null)},className:"px-4 py-2.5 border-2 border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 hover:border-gray-400 transition-all",children:"Clear"})]})]})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary-500 to-primary-600 px-4 py-3 rounded-t-xl",children:[e.jsxs("h3",{className:"font-bold text-white flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"})}),"Quick Templates"]}),e.jsx("p",{className:"text-primary-100 text-xs mt-1",children:"Click to use"})]}),e.jsx("div",{className:"p-3 space-y-2",children:A.map((s,a)=>{const k=s.icon;return e.jsx("button",{onClick:()=>M(s),className:"w-full text-left p-3 border-2 border-gray-200 rounded-lg hover:border-primary-500 hover:bg-primary-50 transition-all group",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-9 h-9 ${s.bgColor} rounded-lg flex items-center justify-center flex-shrink-0`,children:e.jsx(k,{className:`w-5 h-5 ${s.color}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm text-gray-900 group-hover:text-primary-700 transition-colors",children:s.title}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:[s.message.substring(0,50),"..."]})]})]})},a)})}),e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-primary-50 border-t border-gray-200 p-3 rounded-b-xl",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-primary-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{className:"text-xs text-gray-700",children:[e.jsx("p",{className:"font-semibold text-primary-900",children:"How it works"}),e.jsxs("ul",{className:"mt-1 space-y-0.5 text-gray-600",children:[e.jsx("li",{children:"• Stored in parent app"}),e.jsx("li",{children:"• Push notification sent"}),e.jsx("li",{children:"• Instant delivery"})]})]})]})})]})})]})]})})}export{F as default};
