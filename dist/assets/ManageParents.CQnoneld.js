import{w as J,r as i,j as e}from"./index.UZcXu8dh.js";import{I as K,G as O,e as M,J as U,K as Q}from"./api.CIjYu6Aj.js";function Z(){const{toast:t}=J(),[A,z]=i.useState([]),[E,v]=i.useState(!0),[j,x]=i.useState(!1),[c,B]=i.useState(""),[s,w]=i.useState(null),[W,k]=i.useState(!1),[d,f]=i.useState([]),[F,L]=i.useState(!1),[H,T]=i.useState([]),[V,C]=i.useState(!1),[h,p]=i.useState(""),[u,g]=i.useState(!1),[l,b]=i.useState({parent_name:"",parent_email:"",parent_phone:"",relationship:"guardian",is_primary:!0});i.useEffect(()=>{G(),_()},[]);const G=async()=>{try{v(!0);const r=await K();r.success?z(r.data||[]):t.error("Failed to load students")}catch(r){console.error("Error fetching students:",r),t.error("Error loading students")}finally{v(!1)}},_=async()=>{try{C(!0);const r=await O();r.success&&T(r.parents||[])}catch(r){console.error("Error fetching all parents:",r)}finally{C(!1)}},y=async r=>{try{L(!0);const a=await Q(r);a.success?f(a.parents||[]):f([])}catch(a){console.error("Error fetching student parents:",a),f([])}finally{L(!1)}},R=r=>{w(r),k(!0),g(!1),p(""),y(r.id),b({parent_name:"",parent_email:"",parent_phone:"",relationship:"guardian",is_primary:!0})},$=async(r,a="guardian",n=!1)=>{if(!s){t.error("Please select a student first");return}try{x(!0);const o=await M({student_id:s.id,parent_email:r.email,parent_name:r.name,parent_phone:r.phone||"",relationship:a,is_primary:n});o.success?(t.success(`${r.name} linked to ${s.name} successfully!`),y(s.id),p("")):t.error(o.message||"Failed to link parent")}catch(o){console.error("Error linking parent:",o),t.error("An error occurred while linking parent")}finally{x(!1)}},m=r=>{const{name:a,value:n,type:o,checked:N}=r.target;b(D=>({...D,[a]:o==="checkbox"?N:n}))},q=async(r,a)=>{if(confirm(`Are you sure you want to unlink ${a} from ${s==null?void 0:s.name}?`))try{const n=await U(s.id,r);n.success?(t.success("Parent unlinked successfully!"),y(s.id)):t.error(n.message||"Failed to unlink parent")}catch(n){console.error("Error unlinking parent:",n),t.error("An error occurred while unlinking parent")}},I=async r=>{if(r.preventDefault(),!s){t.error("Please select a student first");return}if(!l.parent_name||!l.parent_email){t.error("Parent name and email are required");return}x(!0);try{const a=await M({student_id:s.id,parent_email:l.parent_email,parent_name:l.parent_name,parent_phone:l.parent_phone||"",relationship:l.relationship,is_primary:l.is_primary});a.success?(t.success("Parent created and linked successfully!"),y(s.id),_(),g(!1),b({parent_name:"",parent_email:"",parent_phone:"",relationship:"guardian",is_primary:d.length===0})):t.error(a.message||"Failed to link parent")}catch(a){console.error("Error linking parent:",a),t.error("An error occurred while linking parent")}finally{x(!1)}},P=A.filter(r=>{var a,n,o;return((a=r.name)==null?void 0:a.toLowerCase().includes(c.toLowerCase()))||((n=r.admission_no)==null?void 0:n.toLowerCase().includes(c.toLowerCase()))||((o=r.class)==null?void 0:o.toLowerCase().includes(c.toLowerCase()))}),S=H.filter(r=>{var n,o;return d.some(N=>N.parent_id===r.id)?!1:((n=r.name)==null?void 0:n.toLowerCase().includes(h.toLowerCase()))||((o=r.email)==null?void 0:o.toLowerCase().includes(h.toLowerCase()))});return e.jsx("div",{className:"min-h-screen bg-gray-50 py-8 px-4",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary-600 to-primary-700 px-6 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Manage Parent-Student Relationships"}),e.jsx("p",{className:"text-primary-100",children:"Link parents/guardians to students for portal access"})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-3",children:"Select Student"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search by name, admission no, or class...",value:c,onChange:r=>B(r.target.value),className:"w-full px-4 py-3 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"}),e.jsx("svg",{className:"absolute left-3 top-3.5 h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg border border-gray-200 max-h-[600px] overflow-y-auto",children:E?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-primary-600 border-r-transparent"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading students..."})]}):P.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),e.jsx("p",{children:"No students found"}),c&&e.jsx("p",{className:"text-sm mt-1",children:"Try a different search term"})]}):e.jsx("div",{className:"divide-y divide-gray-200",children:P.map(r=>e.jsx("button",{onClick:()=>R(r),className:`w-full text-left px-4 py-3 hover:bg-primary-50 transition-colors ${(s==null?void 0:s.id)===r.id?"bg-primary-100 border-l-4 border-primary-600":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:r.name}),e.jsxs("div",{className:"flex gap-4 mt-1",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Admission:"})," ",r.admission_no]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Class:"})," ",r.class]})]}),r.guardian_email&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Email: ",r.guardian_email]})]}),e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})},r.id))})})]}),e.jsx("div",{children:W?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Manage Parents for Student"}),e.jsxs("div",{className:"bg-primary-50 border border-primary-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm font-medium text-primary-900",children:"Selected Student:"}),e.jsx("p",{className:"text-lg font-bold text-primary-800",children:s==null?void 0:s.name}),e.jsxs("p",{className:"text-sm text-primary-700",children:[s==null?void 0:s.admission_no," • ",s==null?void 0:s.class]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-md font-semibold text-gray-800 mb-3 flex items-center justify-between",children:[e.jsx("span",{children:"Linked Parents/Guardians"}),d.length>0&&e.jsxs("span",{className:"text-sm font-normal text-gray-600",children:["(",d.length," ",d.length===1?"parent":"parents",")"]})]}),F?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"inline-block h-6 w-6 animate-spin rounded-full border-4 border-solid border-primary-600 border-r-transparent"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Loading parents..."})]}):d.length===0?e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center",children:[e.jsx("svg",{className:"mx-auto h-10 w-10 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})}),e.jsx("p",{className:"text-sm text-gray-600",children:"No parents linked yet"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Add a parent below to get started"})]}):e.jsx("div",{className:"space-y-2",children:d.map(r=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-3 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:r.name}),r.is_primary&&e.jsx("span",{className:"text-xs bg-primary-100 text-primary-800 px-2 py-0.5 rounded-full font-medium",children:"Primary"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("svg",{className:"inline w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),r.email]}),r.phone&&e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("svg",{className:"inline w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),r.phone]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1 capitalize",children:["Relationship: ",r.relationship]})]}),e.jsx("button",{type:"button",onClick:()=>q(r.id,r.name),className:"ml-3 px-3 py-1.5 bg-red-50 text-red-700 text-sm rounded-lg hover:bg-red-100 transition-colors border border-red-200",children:"Unlink"})]})},r.id))})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-md font-semibold text-gray-800",children:u?"Add New Parent/Guardian":"Select Existing Parent"}),e.jsx("button",{type:"button",onClick:()=>{g(!u),p("")},className:"px-4 py-2 text-sm bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors font-medium",children:u?"← Back to Selection":"+ Add New Parent"})]}),u?e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Parent/Guardian Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"parent_name",value:l.parent_name,onChange:m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"e.g., John Doe"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Email Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",name:"parent_email",value:l.parent_email,onChange:m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"parent@example.com"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This email will be used for parent portal login"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),e.jsx("input",{type:"tel",name:"parent_phone",value:l.parent_phone,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"+234812345678"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Relationship ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"relationship",value:l.relationship,onChange:m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"father",children:"Father"}),e.jsx("option",{value:"mother",children:"Mother"}),e.jsx("option",{value:"guardian",children:"Guardian"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("input",{type:"checkbox",name:"is_primary",checked:l.is_primary,onChange:m,className:"mt-1 h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsxs("label",{className:"ml-2 block text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Set as primary contact"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Primary contacts receive important notifications and updates"})]})]}),e.jsx("div",{className:"pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:j,className:"flex-1 bg-primary-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-primary-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:j?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Linking..."]}):"Link Parent to Student"}),e.jsx("button",{type:"button",onClick:()=>{k(!1),w(null)},className:"px-6 py-3 border border-gray-300 rounded-lg font-semibold text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"})]})})]}),e.jsx("div",{className:"mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("svg",{className:"h-5 w-5 text-yellow-600 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Note"}),e.jsxs("p",{className:"text-sm text-yellow-700 mt-1",children:["This will create a new parent account and link them to ",s==null?void 0:s.name,"."]})]})]})})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:"Search parents by name or email...",value:h,onChange:r=>p(r.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm"})}),e.jsx("div",{className:"max-h-96 overflow-y-auto border border-gray-200 rounded-lg bg-white",children:V?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-primary-600 border-r-transparent"}),e.jsx("p",{className:"text-sm text-gray-600 mt-3",children:"Loading parents..."})]}):S.length===0?e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx("svg",{className:"mx-auto h-16 w-16 text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})}),e.jsx("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"No parents found"}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:h?"Try a different search term or add a new parent":"No parents in the system yet"}),e.jsxs("button",{type:"button",onClick:()=>g(!0),className:"inline-flex items-center px-4 py-2 bg-primary-600 text-white text-sm rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add New Parent"]})]}):e.jsx("div",{className:"divide-y divide-gray-200",children:S.map(r=>e.jsx("div",{className:"p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm truncate",children:r.name}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1 truncate",children:[e.jsx("svg",{className:"inline w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),r.email]}),r.phone&&e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:[e.jsx("svg",{className:"inline w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),r.phone]}),r.student_count>0&&e.jsxs("p",{className:"text-xs text-primary-600 mt-1.5 font-medium",children:["Already linked to ",r.student_count," student",r.student_count>1?"s":""]})]}),e.jsx("button",{type:"button",onClick:()=>$(r,"guardian",d.length===0),disabled:j,className:"shrink-0 px-4 py-2 bg-primary-600 text-white text-sm rounded-lg hover:bg-primary-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed font-medium",children:"Link"})]})},r.id))})}),e.jsx("p",{className:"text-xs text-gray-500 mt-3 text-center",children:`Can't find the parent? Click "Add New Parent" above to create a new parent account.`})]})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("svg",{className:"mx-auto h-16 w-16 text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Student Selected"}),e.jsx("p",{className:"text-gray-600",children:"Select a student from the list to link a parent/guardian"})]})})})]})})]})})})}export{Z as default};
