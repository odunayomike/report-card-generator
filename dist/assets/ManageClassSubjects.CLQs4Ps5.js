import{r as l,j as e}from"./index.UZcXu8dh.js";import{z as L,k as _,A as M,x as R,B}from"./api.CIjYu6Aj.js";const D=()=>{const[n,v]=l.useState(""),[h,g]=l.useState([]),[a,o]=l.useState([]),[i,b]=l.useState(""),[d,u]=l.useState(!1),[p,c]=l.useState(""),[j,m]=l.useState(""),[f,N]=l.useState(!1);l.useEffect(()=>{C()},[]);const C=async()=>{try{const t=localStorage.getItem("userType")==="teacher";N(t);let r;if(t)r=await L(),r.success&&g(r.classes||[]);else if(r=await _(),r.success){const x=[...new Set((r.classes||[]).map(A=>A.class_name))];g(x)}}catch(s){console.error("Error loading classes:",s)}},w=async s=>{if(s){u(!0),c("");try{const t=await R(s);if(t.success&&t.data.subjects.length>0)o(t.data.subjects);else{const r=await B(s);r.success&&o(r.data.subjects||[])}}catch(t){c("Error loading subjects"),console.error("Load subjects error:",t)}finally{u(!1)}}},S=s=>{const t=s.target.value;v(t),o([]),t&&w(t)},k=s=>{const t=[...a];t[s].is_core=!t[s].is_core,o(t)},E=s=>{const t=a.filter((r,x)=>x!==s);o(t)},y=()=>{if(!i.trim())return;const s={name:i.trim(),is_core:!1};o([...a,s]),b("")},T=async()=>{if(!n){c("Please select a class");return}if(a.length===0){c("Please add at least one subject");return}u(!0),c(""),m("");try{const s=await M(n,a);s.success?(m("Class subjects configured successfully!"),setTimeout(()=>m(""),3e3)):c(s.message||"Failed to configure subjects")}catch(s){c("Error saving configuration"),console.error("Save configuration error:",s)}finally{u(!1)}};return e.jsxs("div",{className:"px-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Manage Class Subjects"}),e.jsx("p",{className:"text-gray-600",children:f?"Configure subjects for your assigned classes":"Configure which subjects are offered for each class"})]}),f&&h.length===0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900",children:"No Classes Assigned"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"You don't have any classes assigned yet. Please contact your school administrator to assign classes to you."})]})]})}),p&&e.jsx("div",{className:"bg-red-50 border border-red-400 text-red-700 px-4 py-2 rounded mb-4",children:p}),j&&e.jsx("div",{className:"bg-green-50 border border-green-400 text-green-700 px-4 py-2 rounded mb-4",children:j}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Class"}),e.jsxs("select",{value:n,onChange:S,className:"w-full md:w-1/2 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Choose a class..."}),h.map((s,t)=>e.jsx("option",{value:s,children:s},t))]})]}),n&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:["Subjects for ",n]}),d&&a.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading subjects..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 mb-4 max-h-[calc(100vh-380px)] overflow-y-auto",children:[a.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-md border border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[e.jsx("span",{className:"text-gray-900 font-medium text-sm truncate",children:s.name}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded whitespace-nowrap ${s.is_core?"bg-primary-100 text-primary-700":"bg-gray-200 text-gray-700"}`,children:s.is_core?"Core":"Elective"})]}),e.jsxs("div",{className:"flex items-center space-x-1 ml-2",children:[e.jsx("button",{onClick:()=>k(t),className:"text-xs text-primary-600 hover:text-primary-700 font-medium whitespace-nowrap",children:s.is_core?"Elective":"Core"}),e.jsx("button",{onClick:()=>E(t),className:"text-red-600 hover:text-red-700 p-1",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]},t)),a.length===0&&!d&&e.jsx("div",{className:"col-span-2 text-center py-8 text-gray-500",children:"No subjects configured. Add custom subjects or load defaults."})]}),e.jsx("button",{onClick:T,disabled:d||a.length===0,className:"w-full bg-primary-600 hover:bg-primary-700 text-white px-6 py-2 rounded-md font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Saving...":"Save Configuration"})]})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Add Custom Subject"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",value:i,onChange:s=>b(s.target.value),onKeyDown:s=>s.key==="Enter"&&y(),placeholder:"Enter subject name...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"}),e.jsx("button",{onClick:y,disabled:!i.trim(),className:"w-full bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"Add Subject"})]}),e.jsxs("div",{className:"mt-4 bg-primary-50 border border-primary-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-primary-900 mb-1",children:"How it works:"}),e.jsxs("ul",{className:"text-sm text-primary-800 space-y-0.5",children:[e.jsx("li",{children:"• Configure subjects for each class"}),e.jsx("li",{children:'• Mark as "Core" or "Elective"'}),e.jsx("li",{children:"• New students auto-enrolled in all subjects"}),e.jsx("li",{children:"• Students can modify enrollment later"})]})]})]})})]})]})};export{D as default};
